<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eats.mapper.store.GudokMapper">
	<insert id="insertGudok" parameterType="com.eats.store.model.GudokDTO">
	    INSERT INTO GUDOK (
	        GUDOK_IDX, STORE_IDX, GUDOK_START, GUDOK_NEXTPAY, GUDOK_END,
	        GUDOK_TYPE, GUDOK_METHOD, GUDOK_INFO, GUDOK_STAT
	    ) VALUES (
	        GUDOK_IDX_SEQ.NEXTVAL, #{storeIdx}, SYSDATE,
	        <choose>
	            <when test="gudokType == 1">SYSDATE + 30</when>
	            <otherwise>SYSDATE + 365</otherwise>
	        </choose>,
	        NULL, #{gudokType}, #{gudokMethod}, #{gudokInfo}, 1
	    )
	</insert>
	
	<update id="updateNextPaymentDate" parameterType="com.eats.store.model.GudokDTO">
	    UPDATE GUDOK
	    SET GUDOK_NEXTPAY = #{gudokNextpay}
	    WHERE GUDOK_IDX = #{gudokIdx}
	</update>
	
	<select id="getActiveSubscriptions" resultType="com.eats.store.model.GudokDTO">
	    SELECT * FROM GUDOK 
	    WHERE GUDOK_STAT = 1 
	    AND GUDOK_NEXTPAY = TRUNC(SYSDATE)
	    AND GUDOK_END IS NULL
	</select>
</mapper>